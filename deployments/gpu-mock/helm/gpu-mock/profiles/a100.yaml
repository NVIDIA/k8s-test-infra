# Mock NVML Configuration: DGX A100
# Full configuration for nvidia-smi -x -q compatibility
# Use: export MOCK_NVML_CONFIG=/path/to/this/file.yaml

version: "1.0"

# =============================================================================
# System-level configuration
# =============================================================================
system:
  driver_version: "550.163.01"
  nvml_version: "12.550.163.01"
  cuda_version: "12.4"
  cuda_version_major: 12
  cuda_version_minor: 4

# =============================================================================
# Default device configuration (applied to all devices unless overridden)
# =============================================================================
device_defaults:
  # ---------------------------------------------------------------------------
  # Basic identification
  # ---------------------------------------------------------------------------
  name: "NVIDIA A100-SXM4-40GB"
  brand: "nvidia"                    # nvidia, tesla, quadro, geforce, etc.
  serial: "1324821083812"
  board_part_number: "692-2G506-0200-002"
  vbios_version: "92.00.45.00.03"

  # ---------------------------------------------------------------------------
  # Architecture
  # ---------------------------------------------------------------------------
  architecture: "ampere"
  compute_capability:
    major: 8
    minor: 0
  num_gpu_cores: 6912               # CUDA cores

  # ---------------------------------------------------------------------------
  # InfoROM versions
  # ---------------------------------------------------------------------------
  inforom:
    image_version: "G506.0200.00.04"
    oem_object: "2.0"
    ecc_object: "6.16"
    pwr_object: "N/A"

  # ---------------------------------------------------------------------------
  # Memory configuration
  # ---------------------------------------------------------------------------
  memory:
    total_bytes: 42949672960        # 40 GiB HBM2e
    reserved_bytes: 611319808       # ~583 MiB reserved
    free_bytes: 42338353152         # total - reserved at idle
    used_bytes: 0

  bar1_memory:
    total_bytes: 68719476736        # 64 GiB
    free_bytes: 68719476736
    used_bytes: 0

  # ---------------------------------------------------------------------------
  # PCI configuration
  # ---------------------------------------------------------------------------
  pci:
    device_id: 0x20B010DE           # A100 SXM4 40GB
    subsystem_id: 0x134710DE
    # bus_id is auto-generated per device if not specified

  pcie:
    max_link_gen: 4                 # PCIe Gen4
    current_link_gen: 4
    max_link_width: 16              # x16
    current_link_width: 16
    replay_counter: 0
    tx_throughput_kbps: 0           # KB/s
    rx_throughput_kbps: 0

  # ---------------------------------------------------------------------------
  # Power configuration
  # ---------------------------------------------------------------------------
  power:
    management_supported: true
    management_mode: "enabled"
    default_limit_mw: 400000        # 400W
    enforced_limit_mw: 400000
    min_limit_mw: 100000            # 100W
    max_limit_mw: 400000            # 400W
    current_draw_mw: 72000          # 72W idle
    power_state: "P0"               # P0-P12

  # ---------------------------------------------------------------------------
  # Thermal configuration
  # ---------------------------------------------------------------------------
  thermal:
    temperature_gpu_c: 33           # Idle temperature
    temperature_memory_c: 31
    shutdown_threshold_c: 92
    slowdown_threshold_c: 87
    max_operating_c: 83
    target_temperature_c: 83        # For auto fan control

  # ---------------------------------------------------------------------------
  # Fan configuration (N/A for SXM form factor)
  # ---------------------------------------------------------------------------
  fan:
    count: 0                        # SXM has no fans (liquid cooled)
    speed_percent: "N/A"
    target_speed_percent: "N/A"

  # ---------------------------------------------------------------------------
  # Clock speeds (MHz)
  # ---------------------------------------------------------------------------
  clocks:
    graphics_current: 210           # Idle
    graphics_max: 1410
    graphics_app: 1410              # Application clock setting
    graphics_app_default: 1410
    sm_current: 210
    sm_max: 1410
    memory_current: 1215
    memory_max: 1215
    memory_app: 1215
    memory_app_default: 1215
    video_current: 585
    video_max: 1290

  # ---------------------------------------------------------------------------
  # Clocks throttle reasons (bitmask reasons)
  # ---------------------------------------------------------------------------
  clocks_throttle_reasons:
    gpu_idle: true                  # Clock is idle
    applications_clocks_setting: false
    sw_power_cap: false
    hw_slowdown: false
    hw_thermal_slowdown: false
    hw_power_brake_slowdown: false
    sync_boost: false
    sw_thermal_slowdown: false
    display_clocks_setting: false

  # ---------------------------------------------------------------------------
  # Supported clocks (for nvidia-smi -q -d SUPPORTED_CLOCKS)
  # ---------------------------------------------------------------------------
  supported_clocks:
    memory_clocks:
      - freq_mhz: 1215
        graphics_clocks: [210, 420, 630, 840, 1050, 1215, 1275, 1335, 1410]

  # ---------------------------------------------------------------------------
  # Performance state
  # ---------------------------------------------------------------------------
  performance_state: "P0"           # P0 = max performance

  # ---------------------------------------------------------------------------
  # Utilization (percentage, 0-100)
  # ---------------------------------------------------------------------------
  utilization:
    gpu: 0
    memory: 0
    encoder: 0
    decoder: 0
    jpeg: 0
    ofa: 0                          # Optical flow accelerator

  # ---------------------------------------------------------------------------
  # Encoder/Decoder statistics
  # ---------------------------------------------------------------------------
  encoder_stats:
    session_count: 0
    average_fps: 0
    average_latency_us: 0

  fbc_stats:                        # Frame buffer capture
    session_count: 0
    average_fps: 0
    average_latency_us: 0

  # ---------------------------------------------------------------------------
  # ECC configuration
  # ---------------------------------------------------------------------------
  ecc:
    mode_current: "enabled"
    mode_pending: "enabled"
    default_mode: "enabled"
    # Error counts (all zeros for clean GPU)
    errors:
      volatile:
        single_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
        double_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
      aggregate:
        single_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
        double_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0

  # ---------------------------------------------------------------------------
  # Retired pages
  # ---------------------------------------------------------------------------
  retired_pages:
    single_bit_retirement:
      count: 0
      addresses: []
    double_bit_retirement:
      count: 0
      addresses: []
    pending_blacklist: false
    pending_retirement: false

  # ---------------------------------------------------------------------------
  # Remapped rows
  # ---------------------------------------------------------------------------
  remapped_rows:
    correctable: 0
    uncorrectable: 0
    pending: false
    failure_occurred: false

  # ---------------------------------------------------------------------------
  # Display configuration
  # ---------------------------------------------------------------------------
  display:
    mode: "disabled"                # No display output on A100
    active: "disabled"

  # ---------------------------------------------------------------------------
  # Persistence mode
  # ---------------------------------------------------------------------------
  persistence_mode: "enabled"       # Typically enabled on servers

  # ---------------------------------------------------------------------------
  # Compute mode
  # ---------------------------------------------------------------------------
  compute_mode: "default"           # default, exclusive_thread, prohibited, exclusive_process

  # ---------------------------------------------------------------------------
  # MIG configuration
  # ---------------------------------------------------------------------------
  mig:
    mode_current: "disabled"
    mode_pending: "disabled"
    max_gpu_instances: 7            # A100 supports up to 7 MIG instances
    # GPU instances would be defined here if MIG enabled

  # ---------------------------------------------------------------------------
  # GPU operation mode (GOM)
  # ---------------------------------------------------------------------------
  gpu_operation_mode:
    current: "all_on"               # all_on, compute, low_dp
    pending: "all_on"

  # ---------------------------------------------------------------------------
  # Driver model (Windows only)
  # ---------------------------------------------------------------------------
  driver_model:
    current: "N/A"                  # Linux: N/A, Windows: WDDM or TCC
    pending: "N/A"

  # ---------------------------------------------------------------------------
  # Accounting mode
  # ---------------------------------------------------------------------------
  accounting:
    mode: "disabled"
    buffer_size: 4000               # Max PIDs tracked

  # ---------------------------------------------------------------------------
  # Virtualization
  # ---------------------------------------------------------------------------
  virtualization:
    mode: "none"                    # none, passthrough, vgpu
    host_vgpu_mode: "N/A"

  # ---------------------------------------------------------------------------
  # GSP Firmware
  # ---------------------------------------------------------------------------
  gsp_firmware:
    mode: "enabled"                 # GSP enabled on newer drivers
    version: "550.54.15"

  # ---------------------------------------------------------------------------
  # Processes (empty at idle)
  # ---------------------------------------------------------------------------
  processes: []

# =============================================================================
# Device-specific overrides (indexed 0-7 for DGX A100)
# Only specify fields that differ from device_defaults
# =============================================================================
devices:
  - index: 0
    uuid: "GPU-12345678-1234-1234-1234-123456780000"
    serial: "1324821083800"
    pci:
      bus_id: "00000000:07:00.0"
    minor_number: 0

  - index: 1
    uuid: "GPU-12345678-1234-1234-1234-123456780001"
    serial: "1324821083801"
    pci:
      bus_id: "00000000:0F:00.0"
    minor_number: 1

  - index: 2
    uuid: "GPU-12345678-1234-1234-1234-123456780002"
    serial: "1324821083802"
    pci:
      bus_id: "00000000:47:00.0"
    minor_number: 2

  - index: 3
    uuid: "GPU-12345678-1234-1234-1234-123456780003"
    serial: "1324821083803"
    pci:
      bus_id: "00000000:4E:00.0"
    minor_number: 3

  - index: 4
    uuid: "GPU-12345678-1234-1234-1234-123456780004"
    serial: "1324821083804"
    pci:
      bus_id: "00000000:87:00.0"
    minor_number: 4

  - index: 5
    uuid: "GPU-12345678-1234-1234-1234-123456780005"
    serial: "1324821083805"
    pci:
      bus_id: "00000000:90:00.0"
    minor_number: 5

  - index: 6
    uuid: "GPU-12345678-1234-1234-1234-123456780006"
    serial: "1324821083806"
    pci:
      bus_id: "00000000:B7:00.0"
    minor_number: 6

  - index: 7
    uuid: "GPU-12345678-1234-1234-1234-123456780007"
    serial: "1324821083807"
    pci:
      bus_id: "00000000:BD:00.0"
    minor_number: 7

# =============================================================================
# NVLink topology
# =============================================================================
nvlink:
  version: 3
  links_per_gpu: 12
  bandwidth_per_link_gbps: 50       # 50 GB/s per link = 600 GB/s total per GPU
  # NVLink state per link (12 links)
  links:
    - link: 0
      state: "active"
      remote_device_type: "gpu"
      remote_pci_bus_id: "00000000:0F:00.0"
    # ... define all 12 links for full topology
