# Mock NVML Configuration: GB200 NVL (Grace-Blackwell Superchip)
# Full configuration for nvidia-smi -x -q compatibility
# Use: export MOCK_NVML_CONFIG=/path/to/this/file.yaml

version: "1.0"

# =============================================================================
# System-level configuration
# =============================================================================
system:
  driver_version: "560.35.03"
  nvml_version: "12.560.35.03"
  cuda_version: "12.6"
  cuda_version_major: 12
  cuda_version_minor: 6

# =============================================================================
# Default device configuration (applied to all devices unless overridden)
# =============================================================================
device_defaults:
  # ---------------------------------------------------------------------------
  # Basic identification
  # ---------------------------------------------------------------------------
  name: "NVIDIA GB200 NVL"
  brand: "nvidia"
  serial: "1562849103750"
  board_part_number: "699-2G530-0200-000"
  vbios_version: "96.00.9E.00.01"

  # ---------------------------------------------------------------------------
  # Architecture
  # ---------------------------------------------------------------------------
  architecture: "blackwell"
  compute_capability:
    major: 10
    minor: 0
  num_gpu_cores: 18432              # Blackwell has more CUDA cores

  # ---------------------------------------------------------------------------
  # InfoROM versions
  # ---------------------------------------------------------------------------
  inforom:
    image_version: "G530.0200.00.01"
    oem_object: "2.1"
    ecc_object: "7.16"
    pwr_object: "1.0"

  # ---------------------------------------------------------------------------
  # Memory configuration - 192 GiB HBM3e per GPU
  # ---------------------------------------------------------------------------
  memory:
    total_bytes: 206158430208       # 192 GiB HBM3e
    reserved_bytes: 1073741824      # ~1 GiB reserved
    free_bytes: 205084688384        # total - reserved at idle
    used_bytes: 0

  bar1_memory:
    total_bytes: 549755813888       # 512 GiB (unified memory with Grace)
    free_bytes: 549755813888
    used_bytes: 0

  # ---------------------------------------------------------------------------
  # PCI configuration
  # ---------------------------------------------------------------------------
  pci:
    device_id: 0x233010DE           # GB200 (placeholder - check real ID)
    subsystem_id: 0x181710DE

  pcie:
    max_link_gen: 6                 # PCIe Gen6 (or NVLink-C2C to Grace)
    current_link_gen: 6
    max_link_width: 16              # x16
    current_link_width: 16
    replay_counter: 0
    tx_throughput_kbps: 0
    rx_throughput_kbps: 0

  # ---------------------------------------------------------------------------
  # Power configuration - GB200 is much higher power
  # ---------------------------------------------------------------------------
  power:
    management_supported: true
    management_mode: "enabled"
    default_limit_mw: 1000000       # 1000W (full superchip)
    enforced_limit_mw: 1000000
    min_limit_mw: 400000            # 400W minimum
    max_limit_mw: 1200000           # 1200W boost
    current_draw_mw: 145000         # 145W idle
    power_state: "P0"

  # ---------------------------------------------------------------------------
  # Thermal configuration
  # ---------------------------------------------------------------------------
  thermal:
    temperature_gpu_c: 36           # Idle temperature (liquid cooled)
    temperature_memory_c: 34
    shutdown_threshold_c: 95
    slowdown_threshold_c: 90
    max_operating_c: 85
    target_temperature_c: 85

  # ---------------------------------------------------------------------------
  # Fan configuration (N/A - liquid cooled)
  # ---------------------------------------------------------------------------
  fan:
    count: 0                        # Liquid cooled, no fans
    speed_percent: "N/A"
    target_speed_percent: "N/A"

  # ---------------------------------------------------------------------------
  # Clock speeds (MHz) - Blackwell has higher clocks
  # ---------------------------------------------------------------------------
  clocks:
    graphics_current: 345           # Idle
    graphics_max: 2100              # Boost
    graphics_app: 2100
    graphics_app_default: 2100
    sm_current: 345
    sm_max: 2100
    memory_current: 2500            # HBM3e
    memory_max: 2500
    memory_app: 2500
    memory_app_default: 2500
    video_current: 1200
    video_max: 2100

  # ---------------------------------------------------------------------------
  # Clocks throttle reasons
  # ---------------------------------------------------------------------------
  clocks_throttle_reasons:
    gpu_idle: true
    applications_clocks_setting: false
    sw_power_cap: false
    hw_slowdown: false
    hw_thermal_slowdown: false
    hw_power_brake_slowdown: false
    sync_boost: false
    sw_thermal_slowdown: false
    display_clocks_setting: false

  # ---------------------------------------------------------------------------
  # Supported clocks
  # ---------------------------------------------------------------------------
  supported_clocks:
    memory_clocks:
      - freq_mhz: 2500
        graphics_clocks: [345, 690, 1035, 1380, 1725, 1890, 2100]

  # ---------------------------------------------------------------------------
  # Performance state
  # ---------------------------------------------------------------------------
  performance_state: "P0"

  # ---------------------------------------------------------------------------
  # Utilization (percentage, 0-100)
  # ---------------------------------------------------------------------------
  utilization:
    gpu: 0
    memory: 0
    encoder: 0
    decoder: 0
    jpeg: 0
    ofa: 0

  # ---------------------------------------------------------------------------
  # Encoder/Decoder statistics
  # ---------------------------------------------------------------------------
  encoder_stats:
    session_count: 0
    average_fps: 0
    average_latency_us: 0

  fbc_stats:
    session_count: 0
    average_fps: 0
    average_latency_us: 0

  # ---------------------------------------------------------------------------
  # ECC configuration
  # ---------------------------------------------------------------------------
  ecc:
    mode_current: "enabled"
    mode_pending: "enabled"
    default_mode: "enabled"
    errors:
      volatile:
        single_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
        double_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
      aggregate:
        single_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0
        double_bit:
          device_memory: 0
          l1_cache: 0
          l2_cache: 0
          register_file: 0
          texture_memory: 0
          total: 0

  # ---------------------------------------------------------------------------
  # Retired pages
  # ---------------------------------------------------------------------------
  retired_pages:
    single_bit_retirement:
      count: 0
      addresses: []
    double_bit_retirement:
      count: 0
      addresses: []
    pending_blacklist: false
    pending_retirement: false

  # ---------------------------------------------------------------------------
  # Remapped rows
  # ---------------------------------------------------------------------------
  remapped_rows:
    correctable: 0
    uncorrectable: 0
    pending: false
    failure_occurred: false

  # ---------------------------------------------------------------------------
  # Display configuration
  # ---------------------------------------------------------------------------
  display:
    mode: "disabled"
    active: "disabled"

  # ---------------------------------------------------------------------------
  # Persistence mode
  # ---------------------------------------------------------------------------
  persistence_mode: "enabled"

  # ---------------------------------------------------------------------------
  # Compute mode
  # ---------------------------------------------------------------------------
  compute_mode: "default"

  # ---------------------------------------------------------------------------
  # MIG configuration - GB200 supports MIG
  # ---------------------------------------------------------------------------
  mig:
    mode_current: "disabled"
    mode_pending: "disabled"
    max_gpu_instances: 7

  # ---------------------------------------------------------------------------
  # GPU operation mode (GOM)
  # ---------------------------------------------------------------------------
  gpu_operation_mode:
    current: "all_on"
    pending: "all_on"

  # ---------------------------------------------------------------------------
  # Driver model (Windows only)
  # ---------------------------------------------------------------------------
  driver_model:
    current: "N/A"
    pending: "N/A"

  # ---------------------------------------------------------------------------
  # Accounting mode
  # ---------------------------------------------------------------------------
  accounting:
    mode: "disabled"
    buffer_size: 4000

  # ---------------------------------------------------------------------------
  # Virtualization
  # ---------------------------------------------------------------------------
  virtualization:
    mode: "none"
    host_vgpu_mode: "N/A"

  # ---------------------------------------------------------------------------
  # GSP Firmware
  # ---------------------------------------------------------------------------
  gsp_firmware:
    mode: "enabled"
    version: "560.35.03"

  # ---------------------------------------------------------------------------
  # Blackwell-specific features
  # ---------------------------------------------------------------------------
  features:
    transformer_engine: true        # 2nd gen Transformer Engine
    fp4_support: true               # FP4 precision support
    fp8_support: true               # FP8 precision support
    confidential_compute: true      # CC/TEE support
    nvlink_c2c: true                # NVLink Chip-to-Chip (Grace connection)
    decompression_engine: true      # Hardware decompression
    fifth_gen_tensor_cores: true    # 5th generation tensor cores

  # ---------------------------------------------------------------------------
  # Grace CPU pairing (GB200 specific)
  # ---------------------------------------------------------------------------
  grace_superchip:
    enabled: true
    cpu_cores: 72                   # Grace CPU cores
    cpu_memory_gb: 480              # LPDDR5X per Grace CPU
    coherent_memory: true           # NVLink-C2C coherent memory

  # ---------------------------------------------------------------------------
  # Processes (empty at idle)
  # ---------------------------------------------------------------------------
  processes: []

# =============================================================================
# Device-specific overrides
# GB200 NVL72 has 72 GPUs, but we'll define 8 for testing
# In a real GB200 system, GPUs are paired in superchips with Grace CPUs
# =============================================================================
devices:
  - index: 0
    uuid: "GPU-GB200-0000-0000-0000-000000000000"
    serial: "1562849103700"
    pci:
      bus_id: "00000000:0A:00.0"
    minor_number: 0
    grace_cpu_pair: 0               # Paired with Grace CPU 0

  - index: 1
    uuid: "GPU-GB200-0000-0000-0000-000000000001"
    serial: "1562849103701"
    pci:
      bus_id: "00000000:0B:00.0"
    minor_number: 1
    grace_cpu_pair: 0               # Same superchip as GPU 0

  - index: 2
    uuid: "GPU-GB200-0000-0000-0000-000000000002"
    serial: "1562849103702"
    pci:
      bus_id: "00000000:4A:00.0"
    minor_number: 2
    grace_cpu_pair: 1

  - index: 3
    uuid: "GPU-GB200-0000-0000-0000-000000000003"
    serial: "1562849103703"
    pci:
      bus_id: "00000000:4B:00.0"
    minor_number: 3
    grace_cpu_pair: 1

  - index: 4
    uuid: "GPU-GB200-0000-0000-0000-000000000004"
    serial: "1562849103704"
    pci:
      bus_id: "00000000:8A:00.0"
    minor_number: 4
    grace_cpu_pair: 2

  - index: 5
    uuid: "GPU-GB200-0000-0000-0000-000000000005"
    serial: "1562849103705"
    pci:
      bus_id: "00000000:8B:00.0"
    minor_number: 5
    grace_cpu_pair: 2

  - index: 6
    uuid: "GPU-GB200-0000-0000-0000-000000000006"
    serial: "1562849103706"
    pci:
      bus_id: "00000000:CA:00.0"
    minor_number: 6
    grace_cpu_pair: 3

  - index: 7
    uuid: "GPU-GB200-0000-0000-0000-000000000007"
    serial: "1562849103707"
    pci:
      bus_id: "00000000:CB:00.0"
    minor_number: 7
    grace_cpu_pair: 3

# =============================================================================
# NVLink topology - GB200 uses NVLink 5.0
# =============================================================================
nvlink:
  version: 5
  links_per_gpu: 18
  bandwidth_per_link_gbps: 100      # 100 GB/s per link = 1.8 TB/s total per GPU
  switch_support: true              # NVLink Switch for scale-out
  switch_count: 0                   # Set for NVL72 configurations (up to 9 switches)
  c2c_enabled: true                 # NVLink-C2C to Grace CPU
  # NVLink state per link (18 links)
  links:
    - link: 0
      state: "active"
      remote_device_type: "gpu"
      remote_pci_bus_id: "00000000:0B:00.0"
    - link: 1
      state: "active"
      remote_device_type: "cpu"     # NVLink-C2C to Grace
      remote_pci_bus_id: "N/A"
    # ... define all 18 links for full topology
